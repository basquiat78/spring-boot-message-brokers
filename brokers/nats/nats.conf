# 서버 이름 설정 (클러스터링 시 식별자로 사용)
server_name: nats-basquiat-01

# 서버 태그 (메타데이터, 모니터링이나 특정 서버 타겟팅 시 유용)
server_tags: ["env:production", "region:seoul", "tier:messaging"]

# 접속 호스트 설정 (0.0.0.0은 모든 네트워크 인터페이스 허용)
host: 0.0.0.0
# 클라이언트 접속 포트 (기본값: 4222)
port: 4222

# 최대 연결 수 제한
# (연결당 약 10-20KB 메모리 사용 예상, 5000개면 약 50-100MB 사용)
max_connections: 5000

# 단일 메시지 최대 크기 (기본값: 1MB)
# (이 값을 넘는 메시지는 거부됨)
max_payload: 1mb

# 연결당 최대 대기 데이터 크기 (Slow Consumer 보호)
# (클라이언트가 메시지를 충분히 빨리 읽지 못할 때 버퍼링 한도)
max_pending: 64mb

# 클라이언트 생존 확인 (Ping/Pong) 설정
# PING 전송 간격 (2분)
ping_interval: "2m"
# PING 응답 실패 허용 횟수 (2번 실패 시 연결 끊음)
ping_max: 2

# 쓰기 제한 시간 (클라이언트 소켓 쓰기 타임아웃)
write_deadline: "10s"

# JetStream 설정 (메시지 영속성 및 스트림 기능)
# 데이터 저장 경로 (Docker 볼륨과 매핑됨)
# 메모리 저장소 최대 크기
# 파일 저장소 최대 크기
# 메시지별 ttl 옵션 허용
jetstream {
    store_dir: /data/jetstream
    max_memory_store: 1gb
    max_file_store: 100gb
}

# 디버그/로깅 설정
# 디버그 로그 활성화 여부
debug: false
# 로그에 시간 기록 포함 여부
logtime: true
# 로그 파일 저장 경로
log_file: /data/nats-server.log

# HTTP 모니터링 포트
# (http://localhost:8222/varz, /connz, /sysz, /jsz 등으로 상태 확인 가능)
http_port: 8222

# Lame Duck 모드 (Graceful Shutdown)
# (종료 신호 시 바로 안 꺼지고 2분간 대기하며 클라이언트들이 다른 서버로 옮겨갈 시간 줌)
lame_duck_duration: "2m"

# 로컬이라 이 부분은 주석처리
# 아마도 상용 서버에서는 보안을 위해 설정을 할 필요가 있지 않을까?
# 인증 및 권한 설정 및 화이트 리스트 설정
# authorization {
#     users: [
#         {
#             # 관리자 계정
#             user: basquiat
#             password: basquiat
#             permissions {
#                 publish = {allow: [">"]}      # 모든 주제 발행 가능
#                 subscribe = {allow: [">"]}    # 모든 주제 구독 가능
#             }
#         },
#         {
#             # 서비스 API용 계정
#             user: service_api
#             password: service_api
#             permissions {
#                 # api.XXX , event.XXX 로 시작하는 주제만 발행/구독 허용
#                 # 따라서 여기에 정의한 토픽외에는 허용하는 일종의 블랙 리스트 역할
#                 publish = {allow: ["api.>", "event.>"]}
#                 subscribe = {allow: ["api.>", "event.>"]}
#             }
#         }
#     ]
# }